
var ds = [{"Caption":"Карта меню","DataIndicatorType":0,"Values":{"35":2.0,"22":13.0,"34":4.0,"39":1.0,"26":3.0,"15":6.0,"31":1.0,"45":1.0,"42":2.0,"13":4.0,"40":4.0,"17":6.0,"29":2.0,"28":8.0,"30":1.0,"36":1.0,"27":1.0,"24":2.0,"23":1.0,"12":7.0,"33":1.0,"14":2.0,"43":2.0,"41":2.0},"FormatedValues":{"35":"2","22":"13","34":"4","39":"1","26":"3","15":"6","31":"1","45":"1","42":"2","13":"4","40":"4","17":"6","29":"2","28":"8","30":"1","36":"1","27":"1","24":"2","23":"1","12":"7","33":"1","14":"2","43":"2","41":"2"}},{"Caption":"Качество блюд","DataIndicatorType":0,"Values":{"14":5.0,"62":2.0,"22":10.0,"26":2.0,"45":32.0,"35":6.0,"23":10.0,"15":3.0,"27":5.0,"34":5.0,"17":7.0,"43":2.0,"31":6.0,"46":2.0,"41":4.0,"36":4.0,"28":4.0,"40":8.0,"37":5.0,"24":6.0,"33":2.0,"13":3.0,"39":2.0,"29":3.0,"12":1.0,"25":3.0,"30":4.0,"42":8.0},"FormatedValues":{"14":"5","62":"2","22":"10","26":"2","45":"32","35":"6","23":"10","15":"3","27":"5","34":"5","17":"7","43":"2","31":"6","46":"2","41":"4","36":"4","28":"4","40":"8","37":"5","24":"6","33":"2","13":"3","39":"2","29":"3","12":"1","25":"3","30":"4","42":"8"}},{"Caption":"Качество напитков","DataIndicatorType":0,"Values":{"34":13.0,"35":5.0,"29":2.0,"36":4.0,"24":1.0,"27":3.0,"22":5.0,"15":2.0,"13":2.0,"44":1.0,"45":9.0,"43":1.0,"41":2.0,"23":1.0,"17":2.0,"28":3.0,"14":1.0,"25":1.0,"39":2.0,"12":1.0,"19":1.0},"FormatedValues":{"34":"13","35":"5","29":"2","36":"4","24":"1","27":"3","22":"5","15":"2","13":"2","44":"1","45":"9","43":"1","41":"2","23":"1","17":"2","28":"3","14":"1","25":"1","39":"2","12":"1","19":"1"}},{"Caption":"Качество десертов","DataIndicatorType":0,"Values":{"25":1.0,"17":2.0,"34":3.0,"15":2.0,"14":1.0,"30":1.0,"45":2.0,"19":1.0,"36":1.0,"35":4.0,"29":1.0},"FormatedValues":{"25":"1","17":"2","34":"3","15":"2","14":"1","30":"1","45":"2","19":"1","36":"1","35":"4","29":"1"}},{"Caption":"Обслуживание","DataIndicatorType":0,"Values":{"22":47.0,"27":26.0,"17":23.0,"26":11.0,"35":24.0,"44":9.0,"28":24.0,"29":11.0,"40":15.0,"25":17.0,"33":10.0,"42":7.0,"41":7.0,"31":2.0,"34":10.0,"19":3.0,"23":21.0,"12":10.0,"45":15.0,"37":19.0,"24":5.0,"15":9.0,"30":6.0,"13":11.0,"36":5.0,"43":6.0,"14":6.0,"39":3.0,"62":1.0},"FormatedValues":{"22":"47","27":"26","17":"23","26":"11","35":"24","44":"9","28":"24","29":"11","40":"15","25":"17","33":"10","42":"7","41":"7","31":"2","34":"10","19":"3","23":"21","12":"10","45":"15","37":"19","24":"5","15":"9","30":"6","13":"11","36":"5","43":"6","14":"6","39":"3","62":"1"}},{"Caption":"Общее впечатление","DataIndicatorType":0,"Values":{"35":15.0,"45":16.0,"13":18.0,"41":7.0,"34":10.0,"27":6.0,"28":8.0,"29":4.0,"23":13.0,"17":5.0,"62":1.0,"22":19.0,"14":5.0,"24":5.0,"12":1.0,"25":16.0,"26":7.0,"44":3.0,"30":5.0,"37":1.0,"31":1.0,"40":3.0,"15":3.0,"36":4.0,"19":1.0,"20":1.0,"38":4.0,"21":1.0,"43":7.0,"42":3.0},"FormatedValues":{"35":"15","45":"16","13":"18","41":"7","34":"10","27":"6","28":"8","29":"4","23":"13","17":"5","62":"1","22":"19","14":"5","24":"5","12":"1","25":"16","26":"7","44":"3","30":"5","37":"1","31":"1","40":"3","15":"3","36":"4","19":"1","20":"1","38":"4","21":"1","43":"7","42":"3"}},{"Caption":"Еда/доставка","DataIndicatorType":0,"Values":{"15":52.0,"13":26.0,"30":48.0,"14":73.0,"22":74.0,"26":24.0,"28":44.0,"23":49.0,"39":31.0,"31":14.0,"33":54.0,"12":39.0,"17":22.0,"43":23.0,"41":23.0,"40":36.0,"29":3.0,"42":5.0,"27":1.0},"FormatedValues":{"15":"52","13":"26","30":"48","14":"73","22":"74","26":"24","28":"44","23":"49","39":"31","31":"14","33":"54","12":"39","17":"22","43":"23","41":"23","40":"36","29":"3","42":"5","27":"1"}},{"Caption":"Упаковка/комплектность","DataIndicatorType":0,"Values":{"39":27.0,"40":18.0,"14":43.0,"12":29.0,"17":22.0,"15":33.0,"43":12.0,"26":18.0,"13":21.0,"22":34.0,"28":33.0,"23":34.0,"42":4.0,"41":16.0,"27":1.0,"33":11.0,"30":15.0,"29":3.0,"34":1.0,"31":3.0},"FormatedValues":{"39":"27","40":"18","14":"43","12":"29","17":"22","15":"33","43":"12","26":"18","13":"21","22":"34","28":"33","23":"34","42":"4","41":"16","27":"1","33":"11","30":"15","29":"3","34":"1","31":"3"}},{"Caption":"СанПин","DataIndicatorType":0,"Values":{"34":1.0,"33":1.0,"17":1.0,"22":2.0,"15":1.0,"25":1.0,"30":1.0,"40":1.0},"FormatedValues":{"34":"1","33":"1","17":"1","22":"2","15":"1","25":"1","30":"1","40":"1"}},{"Caption":"CakeBuro","DataIndicatorType":0,"Values":{"27":1.0},"FormatedValues":{"27":"1"}},{"Caption":"Отравление","DataIndicatorType":0,"Values":{"13":4.0,"26":1.0,"22":4.0,"43":1.0,"40":2.0,"23":2.0,"12":2.0,"29":2.0,"15":2.0,"31":4.0,"28":3.0,"17":2.0,"37":1.0,"41":1.0,"24":1.0,"14":1.0,"30":1.0,"34":1.0},"FormatedValues":{"13":"4","26":"1","22":"4","43":"1","40":"2","23":"2","12":"2","29":"2","15":"2","31":"4","28":"3","17":"2","37":"1","41":"1","24":"1","14":"1","30":"1","34":"1"}},{"Caption":"Другое","DataIndicatorType":0,"Values":{"27":2.0,"37":1.0,"13":3.0,"28":7.0,"29":1.0,"22":3.0,"12":2.0,"25":2.0,"36":1.0,"15":12.0,"41":2.0,"43":2.0,"44":1.0,"26":2.0,"40":1.0,"23":1.0,"45":1.0,"30":1.0,"17":1.0,"35":1.0},"FormatedValues":{"27":"2","37":"1","13":"3","28":"7","29":"1","22":"3","12":"2","25":"2","36":"1","15":"12","41":"2","43":"2","44":"1","26":"2","40":"1","23":"1","45":"1","30":"1","17":"1","35":"1"}},{"Caption":"Еда/напитки","DataIndicatorType":0,"Values":{"13":3.0,"14":2.0,"26":2.0,"22":2.0,"33":2.0,"23":3.0,"17":1.0,"36":1.0,"43":1.0,"15":5.0,"34":3.0,"28":2.0,"37":1.0,"45":1.0,"24":1.0,"40":2.0,"62":2.0,"44":1.0,"30":1.0,"25":1.0,"12":1.0},"FormatedValues":{"13":"3","14":"2","26":"2","22":"2","33":"2","23":"3","17":"1","36":"1","43":"1","15":"5","34":"3","28":"2","37":"1","45":"1","24":"1","40":"2","62":"2","44":"1","30":"1","25":"1","12":"1"}},{"Caption":"Происшествие","DataIndicatorType":0,"Values":{"15":2.0,"30":1.0,"29":1.0,"13":3.0,"14":1.0,"22":2.0},"FormatedValues":{"15":"2","30":"1","29":"1","13":"3","14":"1","22":"2"}},{"Caption":"Сайт","DataIndicatorType":0,"Values":{},"FormatedValues":{}},{"Caption":"Доставка","DataIndicatorType":0,"Values":{"43":16.0,"14":22.0,"15":53.0,"13":21.0,"17":21.0,"23":37.0,"28":34.0,"44":2.0,"27":5.0,"30":18.0,"33":51.0,"29":5.0,"39":32.0,"40":21.0,"42":21.0,"22":36.0,"26":14.0,"45":15.0,"12":1.0,"64":1.0,"41":1.0},"FormatedValues":{"43":"16","14":"22","15":"53","13":"21","17":"21","23":"37","28":"34","44":"2","27":"5","30":"18","33":"51","29":"5","39":"32","40":"21","42":"21","22":"36","26":"14","45":"15","12":"1","64":"1","41":"1"}},{"Caption":"Мобильное приложение","DataIndicatorType":0,"Values":{"30":1.0},"FormatedValues":{"30":"1"}},{"Caption":"Ценовая политика","DataIndicatorType":0,"Values":{"17":1.0},"FormatedValues":{"17":"1"}}];


function OnButton_report2()
{

    var grid = $("#box_grid_report2").data("kendoGrid");
    if(grid){
        grid.destroy();
    }


    var SD = $("#datepickerstart_rep2").val().split('/');
    var ED = $("#datepickerend_rep2").val().split('/');


    var FStartDate = SD[2]+SD[1]+SD[0];
    var FEndDate = ED[2]+ED[1]+ED[0];


    $.ajax({
        url: "https://s2010/complaints/api/info/GetClassesSummaryTable?FStartDate="+FStartDate+"&FEndDate="+FEndDate,
        type: "GET",
        success: function(data){

            if (typeof(data) ==  "object")
            {

                PrepareDataReport2(data)

            }

        }
    });
}



function PrepareDataReport2(data)
{
    var data_source = [];

    dep_list.forEach(function (item_) {
        var obj = new Object();
        obj["field0"] = item_.DepName;
        data_source.push(obj);

    });

    var ListColumn = [];
    var columns = new Object();
    columns.field = "field0";
    columns.title = "Ресторан";
    columns.width = "200px";
    columns.headerAttributes = {class: "table-header-cell_"};
    ListColumn.push(columns);


    data.forEach(function (item, idx) {

        var columns = new Object();
        var col = idx + 1;
        columns.field = "field"+col;
        columns.title = item.Caption;
        columns.headerAttributes = {class: "table-header-cell_"};
        ListColumn.push(columns);


        Object.keys(item.FormatedValues).map(function(key, index) {

            var value = item.FormatedValues[key];
            var dep_name = GetNameDepartmen(key);

            data_source.forEach(function (value1) {
                if(value1.field0 == dep_name)
                {
                    value1["field"+col] = value;
                }
            })

        });
    });


    $("#box_grid_report2").kendoGrid({
        columns: ListColumn,
        sortable: true,
        height: 700,
        resizable: true,
        navigatable: true,
        dataSource: data_source
    });

    $("#box_grid_report2").data("kendoGrid").dataSource.sort({field: "field0", dir: "asc"});
    $("#box_grid_report2").data("kendoGrid").dataSource.read();
}